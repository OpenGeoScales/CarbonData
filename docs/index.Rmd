---
title: "Carbon Data Analysis"
author: "Saif Shabou"
date: "24/02/2021"
output: 
  html_document:
    toc: true
    toc_depth: 4
    theme: spacelab
    highlight: tango
    number_sections: yes
    code_folding: hide
---

```{r warning=FALSE, message=FALSE, echo = TRUE}
library(dplyr)
library(tidyverse)
library(knitr)
library(plotly)
library(kableExtra)
library(leaflet)
library(RColorBrewer)

```

# Introduction

# Domain knowledge

## Grennhouse Gases (GHG)

### Definition

- Greenhouse gases constitute a group of gases contributing to global warming and climate change.
- Greenhouse gases are gases that trap heat in the atmosphere. 
- Without greenhouse gases, the average temperature of Earth’s surface would be about -18° rather than the present average of 15°.
- Atmospheric concentrations are determined by the balance between sources (emissions of the gas from human activities and natural systems) and sinks (the removal of the gas from the atmosphere by conversion to a different chemical compound or absorption by bodies of water).

### List

The primary greenhouse gases in Earth’s atmosphere are water vapor (H2O), carbon dioxide (CO2), methane (CH4), nitrous oxide (N2O) and ozone (O3).

-**Carbon dioxide (CO2):**

  - Carbon dioxide enters the atmosphere through burning fossil fuels (coal, natural gas, and oil), solid waste, trees and other biological materials, and also as a result of certain chemical reactions (e.g., manufacture of cement).
  - Carbon dioxide is removed from the atmosphere (or “sequesterd”) when it is absorbed by plants as part of the biological carbon cycle.

-**Methane (CH4):**

  - Methane is emitted during the production and transport of coal, natural gas, and oil. Methane emissions also result from livestock and other agricultural practices.
  
-**Nitrous oxide (N2O):**

  - Nitrous oxide is emitted during agricultural and industrial activities, combustion of fossil fuels and solid waste, as well as during treatment of wastewater.

-**Fluorinated gases:**

  - Hydrofluocarbons, perfluocarbons, sulfur hexafluoride, and nitrogen trfluoride are synthetic, powerful greenhouse gases that are emitted from a variety of industrial processes. These gases are typically emitted in sammer quantities, but because they are potent greenhouse gases, they are sometimes referred to as high Global Warming Potential gase
  
### Sources

- The vast majority of anthropogenic carbon dioxide emissions come from combustion of fossil fuels, principally coal, oil and natural gas, with additional contributions coming from deforestation and other changes in land use.

### Global Warming Potential

GHGs warm the earth by absorbing energy and slowing the rate at which the energy escapes to space. Different GHGs can have different effects on the earth’s warming depending on their ability to absorb energy (radiative efficiency) and how long they stay in the atmosphere (lifetime).

The Global Warming Potential was developed to allow comparisons of the global warming impacts of different gases. It is a measure of how much energy the emission of 1 ton of a gas will absorb over a given period of time, relative to the emissions of 1 ton of carbon dioxide. The larger the GWP, the more that given gas warms the earth compared to CO2 over that time period (usually 100 years). GWP provides a common unit of measure which allows analysts to add up emissions estimates of different gases (e.g., to compile a national GHG inventory), and allows policymakers to compare emissions reduction opportunities across sectors. 

- CO2, by definition, has a GWP of 1 regardless of the time period used since it is the gas used as the reference. CO2 emissions cause an increase in the atmospheric concentrations that will least thousands of years.

- Methane (CH4) is estimated to have a GWP of 28-36 over 100 years. CH4 emitted today lasts about a decade on average, which is much less time thanCO2. But CH4 absorbs much more energy than CO2.

- Nitrous Oxide (N2O) has a GWP 265-298 times that of CO2 for a 100-year timescale. BO2 emitted today remains in the atmosphere for more than 100 years, on average.

- Fluorinated gases are high-GWP gases because, for a given amount of mass, they trap substantially more than CO2. The GWPs for these gases can be in the thousands or tens of thousands.



## GHG inventory and assessment

A GHG assessment is an evaluation of the quantity of emitted (or captured and stored) GHGs in the atmosphere over one year resulting from the activities of an organization or a territory.

### Methodology

The methodological princiles vary considerably depending on the type of assessment that is carried out.

- GHG organizational reporting (companies, collectivities, public establishments)
- GHG reporting for territories

The Chapter 8 of the IPCC report provides framewsork and guidance for reporting complete, consistent and transparent national greeenhouse gas inventories, regardless the method used to produce the data.

- [Link to the IPCC reporting guideline](https://www.ipcc-nggip.iges.or.jp/public/2006gl/pdf/1_Volume1/V1_8_Ch8_Reporting_Guidance.pdf)
- [2006 IPCC guidelines for National Greenhouse Gas INventories](https://www.ipcc-nggip.iges.or.jp/public/2006gl/vol1.html)


### Geographical Coverage

- The *2006 Guidelines* are designed to estimate and report on national inventories of anthropogenic greenhouse gas emissions and removels. Anthropogenic emissions and removeals means that greenhouse gas emissions and removals in national inventories are a result of human activities.

- National inventories should include ghg emissions and removals taking place withing national territory and offshore areas over whoch the country has jurisdication. 

### gases included

The 2006 Guidelines can be applied for two groups of greenhouse gases:

- GHG covered by the Montreal Protocol: carbon dioxide, methane, nitrous oxide, hydroflurocarbons, perfluorocarbons...
- Other halogenated greenhouse gases not covered by the Montreal Protocol

### Sectors and categories {#emission_sectors}

The 2006 Guidelines group emissions and removals categories into five main sectors:

- Energy
- Industrial Processes and Product Use (IPPU) 
- Agriculture, Forestry and Other Land Use (AFOLU)
- Waste
- Other

These sectors are divided into several sub-categories with specific codes that can be explored in [the chapter 8.5 of the guideline](https://www.ipcc-nggip.iges.or.jp/public/2006gl/pdf/1_Volume1/V1_8_Ch8_Reporting_Guidance.pdf].

### Scopes

[The Greenhouse Protocol](https://ghgprotocol.org/about-us) provides accounting and reporting standards, sector guidance, calculation tools, and training for businesses and governement. It establishs a comprenhensive, global, standardized framework for measuring and managing emissions from private and public sector operations. The Greenhouse gas Protocol divides emissions into 3 scopes:

- **Scope 1: Direct GHG emissions**

Scope 1 covers all direct GHG emissions by a company. It includes fuel combustion, company and fugitive emissions.

- **Scope 2: Electricity indirect GHG emissions**

Scope 2 covers indirect GHG emissions from consumption of purchased electricity, heat or steam.

- **Scope 1: Other indirect GHG emissions**

Scope 3 covers other indirect emissions, such as the extraction and production of purchased materials and fuels, transport-related activities in vehicles not owned or controlled by the reporting entity, electricity-related activities (e.g. transmission and distribution (T&D) losses) not covered in Scope 2, outsourced activities, waste disposal, etc. Scope 3 emissions (also known as value chain emissions) often represent the largest source of greenhouse gas emissions and in some cases can account for up to 90% of the total carbon impact.

### Frameworks
#### Bilan carbone

In France, ADEME published in 2004 a methodology for quantifying greenhouse gas emissions for organizations, called the Bilan Carbone®. This method is today coordinated and dissiminated by the [Association Bilan carbone](https://www.associationbilancarbone.fr/). 

The Bilan Carbone® method takes account of all greenhouse gases defined by the IPCC for all physical flows without which the organization could not function. This method therefore allows companies and territorial collectivities to carry out a global assessment of GHG emissions, whether direct or indirect. A method has been specifically developed on the territorial scale.

#### GHG Protocol

In 1998, the World Business Council for Sustainable Development (WBCSD) and the World Resources Institutes (WRI) developed, in partnership with companies, NGOs and State representatives, the [GHG Protocol](https://ghgprotocol.org/): "A Corporate Accounting and Reporting Standard". 

This protocol, extensively disseminated internationally, served as the basis for drafting ISO 14064-1:2006.

In October 2011, the GHG Protocol was supplemented by the "Corporate Value Chain (Scope 3) Accounting and Reporting Standard", which details in particular the potential indirect GHG emission categories for an organization.

Since July 2014, a method dedicated to Territories has been made available: the Global Protocol for Community-scale GHG emissions.

## Glossary

- [UNFCCC convention](https://unfccc.int/process-and-meetings/the-convention/what-is-the-united-nations-framework-convention-on-climate-change)
- [Kyoto protocol](https://treaties.un.org/Pages/ViewDetails.aspx?src=TREATY&mtdsg_no=XXVII-7-a&chapter=27&clang=_en):
  - https://ec.europa.eu/eurostat/statistics-explained/index.php?title=Glossary:Kyoto_Protocol
- [Paris Agreement](https://treaties.un.org/Pages/ViewDetails.aspx?src=TREATY&mtdsg_no=XXVII-7-d&chapter=27&clang=_en)
- Carbon Pricing
- Carbon footptint

### Carbon Budget

- A carbon budget is an upper limit of total CO2 emissions associated with remaining below a specific global average - temperature.

- Global emissions budgets are calculated according to historical cumulative emissions from fossil, industrial processes, and land use change, but vary according to the global temperature target that is chosen, the probability of staying below that target, and the emissions of other non CO2 greenhouse gases.

- Emissions budgets are relevant to climate change mitigation because they indicate a finite amount of carbon dioxide that can be emitted over time, before resulting in dangerous levels of global warming.

# Data cartography

## Data providers & producers


### World scale
#### The world Bank

#### World Resources Institute

- **CAIT - Historical Emissions Data**:

CAIT Historic allow for easy access, analysis and visualization of the latest available international greenhouse gas emissions data. It includes information for 191 countries and the European Union, 50 U.S. states, 6 gases, multiple economic sectors, and 160 years - carbon dioxide emissions for 1850-2014 and multi-sector greenhouse gas emission for 1990-2014. 

More description is available [here](https://www.wri.org/resources/data-sets/cait-historical-emissions-data-countries-us-states-unfccc)



#### Our World In Data

#### PIK

#### The United Nations Framework Convention on Climate Change (UNFCCC)

- **History:** 

- The UNFCCC is an international environmental treaty addressing climate change, negotiated by 154 states at tht United Nations Conference on Environment and Development, informally known as the Earth Summit, held in Rio de Janiero in 1992.
- The Climate Change Convention entered into force on 21 March 1994.
Adopted in 1992 at the Rio Earth Summit, most members of the Organization for Economic Cooperation and Development (OECD) plus the states of Central and Eastern Europe - known collectively as Annex I countries - are committed to adopting policies and measures aimed at returning their greenhouse-gas emissions to 1990 levels by the year 2000. All Parties develop and submit "national communications" containing inventories of greenhouse gas emissions by source and greenhouse gas removals by sinks.

- **Objectives:**

  - The UNFCCC seeks for the stabilization of greenhouse gas concentrations in the atmosphere at a level that would prevent dangerous anthropogenic human-induced interferences with the earth’s climate system.
  - Definition guidelines for submitting annual national greenhouse gas emissions inventories
  - The GHG data displayed on the UNFCC website are data from official submissions of GHG emissions/removals data by countries that are Parties to the Climate Change Convention.

- **Parties:**

The Convention divides countries into three main groups according to differing [commitments](https://unfccc.int/process/parties-non-party-stakeholders/parties-convention-and-observer-states). Here is the description of these categories ([source](https://unfccc.int/parties-observers)). 

    -Annex I Parties include the Industrialized  countries that were members of the OECD (Organization for Economic Co-operation and Development) in 1992, plus countries with economies in transition (the EIT parties), including the Russian Federation, the Baltic States, and several Central and Eastern European States.
    
    -Annex II Parties consist of the OECD members of Annex I, but not the EIT Parties. They are required to provide financial resources to enable developing countries to undertake emissions reduction activities under the Convention and to help them adapt to adverse effects of climate change.
    
    - Non-Annex I Parties are mostly developing countries. Certain groups of developing countries are recognized by the Convention as being especially vulnerable to the adverse impacts of climate change, including countries with low-lying coastal areas and those prone to desertification and drought. Others (such as countries that rely heavily on income from fossil fuel production and commerce) feel more vulnerable to the potential economic impacts of climate change response measures.
    

### Europe scale
#### European Environmental Agency

  - The [European Environment Agency (EEA)](https://www.eea.europa.eu/about-us) is an agency of the European Union, whose task is to provide sound, independent information on the environment. The EEA aims to support sustainable development by helping to achieve significant and measurable improvement in Europe's environment, through the provision of timely, targeted, relevant and reliable information to policymaking agents and the public.

  - The [European environment information and observation network (Eionet)](https://www.eea.europa.eu/about-us/countries-and-eionet) is a partnership network of the EEA and its member and cooperating countries. Through Eionet, the EEA brings together environmental information from individual countries concentrating on the delivery of timely, nationally validated, high-quality data.
  
  - https://ec.europa.eu/eurostat/web/climate-change/data
- https://ec.europa.eu/eurostat/web/climate-change/data/database
- https://ec.europa.eu/eurostat/databrowser/view/sdg_13_10/default/table?lang=en
- https://ec.europa.eu/eurostat/databrowser/view/sdg_13_10/default/table?lang=en
- https://ec.europa.eu/eurostat/statistics-explained/index.php/Greenhouse_gas_emission_statistics
- https://www.eea.europa.eu/themes/air/links/data-sources/emission-database-for-global-atmospheric
- https://edgar.jrc.ec.europa.eu/overview.php?v=booklet2018&dst=CO2pc
- https://www.eea.europa.eu/data-and-maps/indicators/greenhouse-gas-emission-trends-7/assessment
- https://www.eea.europa.eu/data-and-maps/data/greenhouse-gas-emission-projections-for-7
- https://www.eea.europa.eu/data-and-maps/data#c0=5&c11=&c5=all&b_start=0
- https://www.eea.europa.eu/data-and-maps/data/approximated-estimates-for-greenhouse-gas-emissions-2
- https://www.eea.europa.eu/data-and-maps/data/national-emissions-reported-to-the-unfccc-and-to-the-eu-greenhouse-gas-monitoring-mechanism-16
- https://edgar.jrc.ec.europa.eu/overview.php?v=temp_profile
- https://edgar.jrc.ec.europa.eu/overview.php?v=50_GHG

#### Eurostat

### National & sub-national scale (France use case)

#### ADEME

#### Citepa

## Datasets

Data provider |Data sets | Geoscale | Data source | 
---|---|---|---|
The World Bank |GHG emissions indicators | `World scale`  `Country scale`|  | 
The World Resources Institute - CAIT dataset | | `World scale`  `Country scale`|  |
The World Resources Institute - UNFCCC dataset | | `World scale`  `Country scale`|  |
The World Resources Institute - PIK dataset | | `World scale`  `Country scale`|  |
UNFCCC | | `World scale`  `Country scale`|  |
PIK | | `World scale`  `Country scale`|  | 
OECD | | `OECD scale`  `Country scale`|  [OECD.Stat](https://stats.oecd.org/Index.aspx?DataSetCode=AIR_GHG) |
European Environmental Agency | | `Europe scale`  `Country scale`|  |
Our World In Data | CO2 emissions data | `World scale`  `Country scale`|  |
Global Carbon Project | CO2 emissions data | `World scale`;`Country scale`; `City scale`|  |
ADEME | Carbon footprint | `City scale`|  |
Citepa | GHG emissions data | `Country scale`; `City scale`|  |
Carbon Disclosure Project | GHG emissions data | `City scale`|  |

## data modeling

We propose a data model for mapping the various data source identified

Column name | Type | Description |
---|---|---| 
data.source | string |  |
data.provider | string |  |
geo.scale | string |  |
geo.code.iso2c | string |  |
geo.code.iso3c | string |  |
geo.name | string |  |
year | numeric |  |
sector | string |  |
gas | string |  |
value | numeric |  |
unit | string |  

```{r warning=FALSE, message=FALSE, echo = TRUE}
# create dataset
OGS_ghg_emission = data.frame(data.source = as.character(),
                              data.provider = as.character(),
                              geo.scale = as.character(),
                              geo.code.iso2c = as.character(),
                              geo.code.iso3c = as.character(),
                              geo.name = as.character(),
                              year = as.numeric(),
                              sector = as.character(),
                              gas = as.character(),
                              value = as.numeric(),
                              unit = as.character())

```

# World scale

## Data sources exploration

### World Bank 

#### Data description

The World Bank provides access to several indicators related to GHG emissions. This data is provided through API or by [download](https://data.worldbank.org/indicator/EN.ATM.GHGT.KT.CE). 

In the example below, we will use the R package `WDI`, which provides easy access to World Bank indicators as shwon in the table below. 

```{r warning=FALSE, message=FALSE, echo = TRUE}

library(WDI)
 
# get datasets on emissions

datasets_emissions = as.data.frame(WDIsearch("emissions"))

# Show datasets on emissions
datasets_emissions  %>% 
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F, font_size = 13) %>% 
  scroll_box(width = "100%", height = "400px")
```

We will select for this article the indicator `EN.ATM.GHGT.KT.CE`, which corresponds to the total greenhouse gas emissions (measured in kt of CO2 equivalent).

```{r warning=FALSE, message=FALSE, echo = TRUE}
# get Total greenhouse gas emissions (kt of CO2 equivalent)
ghg_emissions_wb = WDI(indicator='EN.ATM.GHGT.KT.CE')

# Show data sample 
ghg_emissions_wb %>% 
  filter(country == "World") %>% 
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F, font_size = 13) %>% 
  scroll_box(width = "100%", height = "400px")
```

#### Data mapping


```{r warning=FALSE, message=FALSE, echo = TRUE}

# Mapping function
OGS.MAP.WB = function(Worldbank_data, start_date, end_date, geoscale, geoname.filter){
  Worldbank_data_OGS = Worldbank_data %>% 
    add_column(data.source = "World.Bank",
               data.provider = "World.Bank",
               geo.scale = geoscale,
               sector = "All",
               gas = "All",
               geo.code.iso3c = NA,
               unit = "MtCO₂e") %>% 
    rename(geo.code.iso2c = iso2c,
           geo.name = country,
           value = EN.ATM.GHGT.KT.CE) %>% 
    select(data.source, data.provider, geo.scale, geo.code.iso2c, geo.code.iso3c, geo.name,
           year, sector, gas, value) %>% 
    filter(year >= start_date & year <= end_date) %>% 
    filter(geo.name == geoname.filter) %>%
    mutate(value = value * 0.001)
  
  return(Worldbank_data_OGS)
}

# mapping data
Worldbank_data_OGS = OGS.MAP.WB(Worldbank_data = ghg_emissions_wb,
                                start_date = 1970,
                                end_date = 2012,
                                geoscale = "World",
                                geoname.filter = "World" )

# plot timeserie
Worldbank_data_OGS %>% 
  plot_ly() %>% 
  add_trace(y = ~value, 
            x = ~year, 
            type = 'scatter',
            mode = 'lines+markers',
            orientation = "v",
            hoverinfo = 'text',
            text = ~paste('</br> Year: ', year,
                          '</br> Value: ', value,
                          '</br> Gas: ', gas,
                          '</br> Sector: ', sector,
                          '</br> Source: ', data.provider)) %>% 
  layout(title = "World GHG emissions (source: WRI - CAIT)",
         yaxis = list(title = "GHG emissions"), 
         xaxis = list(title = "Years"))
``` 

### World Resources Institute

The World Resources Institute compile various sources of GHG emissions and provide access to this data through a specific tool: [CLIMAT WATCH](https://www.climatewatchdata.org/data-explorer/historical-emissions?historical-emissions-data-sources=cait&historical-emissions-gases=&historical-emissions-regions=&historical-emissions-sectors=&page=1). Climate Watch enables the exploration of historical GHG emissions data, downnload and collection via a specified API. 


```{r warning=FALSE, message=FALSE, echo = TRUE}
# load data
ghg_emissions_wri = read.csv("https://raw.githubusercontent.com/OpenGeoScales/CarbonData/feature-article/datasets/raw/wri/historical_emissions/historical_emissions.csv", 
                             encoding = "UTF-8")

```

Historic emission data is provided in wide format and contains emissions for various sectors and gases. The table below describes the data content.

Column | Description |
---| ---|
Country | The country name |
Data.source | Five data sources: `CAIT`, `PIK`, `GCP`, `UNFCCC_AI`, `UNFCCC_NAI` |
Sector | 30 categories of sectors: `Total including LUCF`,`Total excluding LUCF`, `Total fossil fuels and cement`, `Electricity/Heat`, `Coal`, `Oil`... |
Gas | 8 categories of sectors: `All GHG`,`KYOTOGHG`, `CO2`, `Aggregate GHGs`, `CH4`, `N2O`, `F-Gas` , `Aggregate F-gases`|
Unit | One unit: `MtCO₂e` |
1850 | Emission quantity in 1850 |
1851 | Emission quantity in 1850 |
.. | Emission quantity in 1851 |
2019 | Emission quantity in 2019 |


**Sector categories by data source:**  

We observe that sector catagories differ depending on  data sources:

```{r warning=FALSE, message=FALSE, echo = TRUE}
# get sectors from different data sources
sector_CAIT = ghg_emissions_wri %>% 
  filter(Data.source == "CAIT") %>% 
  distinct(Sector) %>% 
  select(Sector.CAIT = Sector) %>% 
  arrange(Sector.CAIT)

sector_PIK = ghg_emissions_wri %>% 
  # select PIK datasource
  filter(Data.source == "PIK") %>% 
  distinct(Sector) %>% 
  select(Sector.PIK = Sector) %>% 
  arrange(Sector.PIK)

sector_GCP = ghg_emissions_wri %>% 
  # select GCP datasource
  filter(Data.source == "GCP") %>% 
  distinct(Sector) %>% 
  select(Sector.GCP = Sector) %>% 
  arrange(Sector.GCP)

sector_UNFCCC_AI = ghg_emissions_wri %>% 
  # select UNFCCC_AI datasource
  filter(Data.source == "UNFCCC_AI") %>% 
  distinct(Sector) %>%  
  select(Sector.UNFCCC_AI = Sector) %>% 
  arrange(Sector.UNFCCC_AI)

sector_UNFCCC_NAI = ghg_emissions_wri %>% 
  # select UNFCCC_NAI datasource
  filter(Data.source == "UNFCCC_NAI") %>% 
  distinct(Sector) %>% 
  select(Sector.UNFCCC_NAI = Sector) %>% 
  arrange(Sector.UNFCCC_NAI)

# plot table
knitr::kable(list(sector_CAIT, sector_PIK, sector_GCP, sector_UNFCCC_AI, sector_UNFCCC_NAI)) %>% 
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F, font_size = 12) %>% 
  scroll_box(width = "100%", height = "200px")

```

**Gas categories by data source**  

We observe that gases catagories differ depending on data sources:

```{r warning=FALSE, message=FALSE, echo = TRUE}

# get gas from different data sources
gas_CAIT = ghg_emissions_wri %>% 
  filter(Data.source == "CAIT") %>% 
  distinct(Gas) %>% 
  select(Gas.CAIT = Gas) %>% 
  arrange(Gas.CAIT)

gas_PIK = ghg_emissions_wri %>% 
  # select PIK datasource
  filter(Data.source == "PIK") %>% 
  distinct(Gas) %>% 
  select(Gas.PIK = Gas) %>% 
  arrange(Gas.PIK)

gas_GCP = ghg_emissions_wri %>% 
  # select GCP datasource
  filter(Data.source == "GCP") %>% 
  distinct(Gas) %>% 
  select(Gas.GCP = Gas) %>% 
  arrange(Gas.GCP)

gas_UNFCCC_AI = ghg_emissions_wri %>% 
  # select UNFCCC_AI datasource
  filter(Data.source == "UNFCCC_AI") %>% 
  distinct(Gas) %>%  
  select(Gas.UNFCCC_AI = Gas) %>% 
  arrange(Gas.UNFCCC_AI)

gas_UNFCCC_NAI = ghg_emissions_wri %>% 
  # select UNFCCC_NAI datasource
  filter(Data.source == "UNFCCC_NAI") %>% 
  distinct(Gas) %>% 
  select(Gas.UNFCCC_NAI = Gas) %>% 
  arrange(Gas.UNFCCC_NAI)

# plot table
knitr::kable(list(gas_CAIT, gas_PIK, gas_GCP, gas_UNFCCC_AI, gas_UNFCCC_NAI)) %>% 
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F, font_size = 12) %>% 
  scroll_box(width = "100%", height = "200px")

```

**Considered countries by data source** 

The number of considered countries is not the same depending on the data sources as shown in the table below:

```{r warning=FALSE, message=FALSE, echo = TRUE}
ghg_emissions_wri %>% 
  group_by(Data.source) %>% 
  summarise(Nb.Country=length(unique(Country))) %>% 
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F, font_size = 13) 

```

  - *CAIT* data source contains data for **193** distinct countries (all countries that are [member states of the United Nations](https://www.worldometers.info/united-nations/)) with aggregated data on world scale (`World`) and European Union (`European Union (27)`)
  
  - *GCP* data source contains data for the **193** countries members states of the United Nations plus the state of Palestine and  aggregated data on world scale (`World`) and European Union (`European Union (27)`) 
  
  - *PIK* data source contains data for the **193** countries members states of the United Nations in addition to aggregated data on groups of countries such as: `Umbrella Group`, `Least Developed Countries`, `Non-Annex-I Parties to the Convention`, `Annex-I Parties to the Convention`...
  
  - *UNFCCC Annex I* data source contains data for **43** countries members of the Annex I convention with aggregated data on belonging parties (`Annex-I Parties to the Convention`) and European Union scale (`European Union (27)`). 
  
  - *UNFCCC Non-Annex I* data source contains data for **148** countries that are parts of the non-Annex I convention. 


#### WRI-CAIT Data description

- **Description**: 

CAIT Historic allow for easy access, analysis and visualization of the latest available international greenhouse gas emissions data. It includes information for 191 countries and the European Union, 50 U.S. states, 6 gases, multiple economic sectors, and 160 years - carbon dioxide emissions for 1850-2014 and multi-sector greenhouse gas emission for 1990-2014. 

More description is available [here](https://www.wri.org/resources/data-sets/cait-historical-emissions-data-countries-us-states-unfccc)

- **License and reuse**: 

All CAIT data carries a Creative Commons Attribution-NonCommercial 4.0 International license. This means CAIT data and analysis can be used in non-commercial applications, provided clear attribution to WRI/CAIT is given. Additionally to citing CAIT it is recommended consider citing the data sources that CAIT is using.

CAIT 2.0 UNFCCC data derives directly from United Nations Framework Convention on Climate Change (UNFCCC) Secretariat. Additionally to citing CAIT 2.0 please consider citing UNFCCC data source that CAIT 2.0 is using: United Nations Framework Convention on Climate Change (UNFCCC) Secretariat. 2013. "Time Series – Annex I." Bonn: UNFCCC.



```{r warning=FALSE, message=FALSE, echo = TRUE}
# data processing

ghg_emissions_wri_CAIT = ghg_emissions_wri %>% 
  # select all world data & all gases data & total sector
  filter(Data.source == "CAIT",
         Country == "World", 
         Gas == "All GHG",
         Sector == "Total including LUCF") %>% 
  # pivot data
  pivot_longer(
    cols = starts_with("X"), 
    names_to = "year",
    names_prefix = "X",
    values_to = "value") %>% 
  mutate_at("year" , as.numeric) %>% 
  arrange(year)

# plot table
ghg_emissions_wri_CAIT %>% 
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F, font_size = 13) %>% 
  scroll_box(width = "100%", height = "200px")
```


#### WRI-CAIT Data mapping

```{r warning=FALSE, message=FALSE, echo = TRUE}
OGS.MAP.WRI.CAIT = function(wri_data, start_date, end_date, geoscale, datasource.filter, geoname.filter, gas.filter, sector.filter){
  wri_data_OGS = wri_data %>% 
    filter(Data.source == datasource.filter,
           Country == geoname.filter) %>% 
    # recode sectors and gas values
    mutate(sector = fct_collapse(Sector, "All" = "Total including LUCF"),
           gas = fct_collapse(Gas, "All" = "All GHG")) %>% 
    # filter gas and sector
    filter(sector == sector.filter,
           gas == gas.filter) %>% 
    # pivot data
    pivot_longer(
      cols = starts_with("X"), 
      names_to = "year",
      names_prefix = "X",
      values_to = "value") %>% 
    mutate_at("year" , as.numeric) %>% 
    arrange(year) %>% 
    add_column(data.provider = "WRI.CAIT",
               geo.scale = geoscale,
               geo.code.iso3c = NA,
               geo.code.iso2c = NA,
               unit = "MtCO₂e") %>% 
    rename(data.source = Data.source,
           geo.name = Country,
           value = value) %>% 
    select(data.source, data.provider, geo.scale, geo.code.iso2c, geo.code.iso3c, geo.name,
           year, sector, gas, value) %>% 
    filter(year >= start_date & year <= end_date) %>% 
    mutate_at("value" , as.numeric) 
  
  return(wri_data_OGS)
}


wri_data_OGS = OGS.MAP.WRI.CAIT(wri_data = ghg_emissions_wri,
                                datasource.filter = "CAIT",
                                geoname.filter = "World",
                                gas.filter = "All",
                                sector.filter = "All",
                                geoscale = "World",
                                start_date = 1990,
                                end_date = 2016)

# plot timeserie
wri_data_OGS %>% 
  # filter(year >= 1990 & year < 2017) %>% 
  plot_ly() %>% 
  add_trace(y = ~value, 
            x = ~year, 
            type = 'scatter',
            mode = 'lines+markers',
            orientation = "v",
            hoverinfo = 'text',
            text = ~paste('</br> Year: ', year,
                          '</br> Value: ', value,
                          '</br> Gas: ', gas,
                          '</br> Sector: ', sector,
                          '</br> Source: ', data.provider)) %>% 
  layout(title = "World GHG emissions (source: WRI - CAIT)",
         yaxis = list(title = "GHG emissions"), 
         xaxis = list(title = "Years"))

```

#### WRI - GCP 

#### WRI - UNFCCC 

#### WRI - PIK

### Our world in data

#### Data description

```{r warning=FALSE, message=FALSE, echo = TRUE}
# read co2 data
ghg_emissions_owid= read.csv("https://raw.githubusercontent.com/owid/co2-data/master/owid-co2-data.csv", 
                             encoding = "UTF-8")

```


```{r warning=FALSE, message=FALSE, echo = TRUE}
# plot table
ghg_emissions_owid %>% 
  filter(country == "World") %>% 
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F, font_size = 13) %>% 
  scroll_box(width = "100%", height = "200px")

```

#### Data mapping

```{r warning=FALSE, message=FALSE, echo = TRUE}
OGS.MAP.OWID = function(owid_data, geoscale, geoname.filter){
  owid_data_OGS = owid_data %>% 
    filter(country == geoname.filter) %>% 
    add_column(data.provider = "OWID",
               data.source = "OWID",
               geo.scale = geoscale,
               sector = "All",
               geo.code.iso2c = NA,
               unit = "MtCO₂",
               gas = "CO2") %>% 
    rename(geo.code.iso3c = iso_code,
           geo.name = country,
           value = co2) %>% 
    select(data.source, data.provider, geo.scale, geo.code.iso2c, geo.code.iso3c, geo.name,
           year, sector, gas, value)  
  
  return(owid_data_OGS)
}

owid_data_OGS = OGS.MAP.OWID(owid_data = ghg_emissions_owid,
                             geoscale = "World",
                             geoname.filter = "World")

# plot timeserie
owid_data_OGS %>% 
  # filter(year >= 1990 & year < 2017) %>% 
  plot_ly() %>% 
  add_trace(y = ~value, 
            x = ~year, 
            type = 'scatter',
            mode = 'lines+markers',
            orientation = "v",
            hoverinfo = 'text',
            text = ~paste('</br> Year: ', year,
                          '</br> Value: ', value,
                          '</br> Gas: ', gas,
                          '</br> Sector: ', sector,
                          '</br> Source: ', data.provider)) %>% 
  layout(title = "World GHG emissions (source: WRI - CAIT)",
         yaxis = list(title = "GHG emissions"), 
         xaxis = list(title = "Years"))
```

## Data comparison


```{r warning=FALSE, message=FALSE, echo = TRUE}
OGS_ghg_emission = bind_rows(Worldbank_data_OGS, 
                             wri_data_OGS,
                             owid_data_OGS)

# plot timeserie
OGS_ghg_emission %>% 
  filter(year >= 1990) %>%
  plot_ly() %>% 
  add_trace(y = ~value, 
            x = ~year, 
            color = ~data.provider,
            type = 'scatter',
            # type = "line",
            mode = 'lines+markers',
            orientation = "v",
            hoverinfo = 'text',
            text = ~paste('</br> Year: ', year,
                          '</br> Value: ', value,
                          '</br> Gas: ', gas,
                          '</br> Sector: ', sector,
                          '</br> Source: ', data.provider)) %>% 
  layout(title = "World GHG emissions",
         yaxis = list(title = "GHG emissions (MtCO₂)"), 
         xaxis = list(title = "Years"))
```

# Country scale: France use case

## Data sources

### European Environmental Agency Data 

#### Data Exploration

- Data used in this article has been downloaded from here: https://www.eea.europa.eu/data-and-maps/data/national-emissions-reported-to-the-unfccc-and-to-the-eu-greenhouse-gas-monitoring-mechanism-16

- EEA GHG emissions data represents national emissions reported to the UNFCCC and to the EU Greenhouse Gas Monitoring Mechanis, sent by countries to UNFCCC and the EU Greenhouse Gas Monitoring Mechanism (EU Member States). This data set reflects the GHG inventory data for 2020 as reported under the United Nations Framework Convention for Climate Change with respect to sector categories described in [this section](#emission_sectors).

```{r warning=FALSE, message=FALSE, echo = TRUE}

ghg_emissions_eea <- readr::read_csv(file = "https://raw.githubusercontent.com/OpenGeoScales/CarbonData/main/datasets/raw/eea/UNFCCC_v23.csv")

```

The table below describes a complete description of variable definition:

Column name | Description |
--- |--- |
Country_code | International Country code (ISO 3166-1-Alpha-2 code elements) |
Country | country name |
Format_name | Name of guideline (e.g., IPCC Common Reporting Format)  |
Pollutant_name | Short name of pollutant (`CO2`, `CH4`, `All greenhouse gases - (CO2 equivalent)`, `Unspecified mix of HFCs and PFCs - (CO2 equivalent)`, `HFCs - (CO2 equivalent)`, `SF6 - (CO2 equivalent)`, `N2O`, `NF3 - (CO2 equivalent)`, `PFCs - (CO2 equivalent)`) |
Sector_code | Sector code  (e.g., `1`,`1.A.1.b`, `Sectors/Totals_excl`...) |
Sector_name | Sector name (e.g., `Total (without LULUCF)`,`5 - Waste management`, `2 - Industrial Processes and Product Use`...)|
Parent_sector_code | Parent sector code  (e.g., `1`,`4.A`, `2.B`...)|
Unit | Unit of the measure value (`Gg CO2 equivalent`) |
Year |Year (1985-2018)|
emissions | Emission value |
Notation | Notation key |
PublicationDate | Publication Date |

#### Data Mapping

```{r warning=FALSE, message=FALSE, echo = TRUE}
OGS.MAP.EEA = function(eea_data, geoscale, geoname.filter, sector.filter, gas.filter){
  eea_data_OGS = eea_data %>% 
    # recode sectors and gas values
    mutate(sector = fct_collapse(Sector_name, "All" = "Total (with LULUCF)"),
           gas = fct_collapse(Pollutant_name, "All" = "All greenhouse gases - (CO2 equivalent)")) %>% 
    # rename columns
    add_column(data.provider = "EEA",
               geo.scale = geoscale,
               geo.code.iso3c = NA,
               unit = "MtCO₂e") %>% 
    rename(data.source = DataSource,
           geo.code.iso2c = Country_code,
           geo.name = Country,
           value = emissions,
           year = Year) %>% 
    select(data.source, data.provider, geo.scale, geo.code.iso2c, geo.code.iso3c, geo.name,
           year, sector, gas, value) %>% 
    # filter
    filter(geo.name == geoname.filter & sector == sector.filter & gas == gas.filter) %>% 
    mutate_at("value" , as.numeric) %>% 
    mutate_at("year" , as.numeric) %>% 
    mutate(value = value * 0.001) %>% 
    arrange(year)
  
  return(eea_data_OGS)
}


eea_data_OGS_fr = OGS.MAP.EEA(ghg_emissions_eea,
                              geoscale = "Country",
                              geoname.filter = "France",
                              sector.filter = "All",
                              gas.filter = "All")

# plot timeserie

eea_data_OGS_fr %>% 
  plot_ly() %>% 
  add_trace(y = ~value, 
            x = ~year, 
            color = ~data.provider,
            type = 'scatter',
            # type = "line",
            mode = 'lines+markers',
            orientation = "v",
            hoverinfo = 'text',
            text = ~paste('</br> Year: ', year,
                          '</br> Value: ', value,
                          '</br> Gas: ', gas,
                          '</br> Sector: ', sector,
                          '</br> Source: ', data.provider)) %>% 
  layout(title = "France -  GHG emissions (source: EEA)",
         yaxis = list(title = "GHG emissions (MtCO₂)"), 
         xaxis = list(title = "Years"))

```

### The World Bank

```{r warning=FALSE, message=FALSE, echo = TRUE}
Worldbank_data_OGS_fr = OGS.MAP.WB(Worldbank_data = ghg_emissions_wb,
                                start_date = 1970,
                                end_date = 2012,
                                geoscale = "Country",
                                geoname.filter = "France" )

# plot timeserie
Worldbank_data_OGS_fr %>% 
  plot_ly() %>% 
  add_trace(y = ~value, 
            x = ~year, 
            type = 'scatter',
            mode = 'lines+markers',
            orientation = "v",
            hoverinfo = 'text',
            text = ~paste('</br> Year: ', year,
                          '</br> Value: ', value,
                          '</br> Gas: ', gas,
                          '</br> Sector: ', sector,
                          '</br> Source: ', data.provider)) %>% 
  layout(title = "France -  GHG emissions (source: Wrold Bank)",
         yaxis = list(title = "GHG emissions"), 
         xaxis = list(title = "Years"))

```

### The World resources Institute - CAIT

```{r warning=FALSE, message=FALSE, echo = TRUE}
wri_CAIT_data_OGS_fr = OGS.MAP.WRI.CAIT(wri_data = ghg_emissions_wri,
                                datasource.filter = "CAIT",
                                geoname.filter = "France",
                                gas.filter = "All",
                                sector.filter = "All",
                                geoscale = "World",
                                start_date = 1990,
                                end_date = 2016)

# plot timeserie
wri_CAIT_data_OGS_fr %>% 
  plot_ly() %>% 
  add_trace(y = ~value, 
            x = ~year, 
            type = 'scatter',
            mode = 'lines+markers',
            orientation = "v",
            hoverinfo = 'text',
            text = ~paste('</br> Year: ', year,
                          '</br> Value: ', value,
                          '</br> Gas: ', gas,
                          '</br> Sector: ', sector,
                          '</br> Source: ', data.provider)) %>% 
  layout(title = "France GHG emissions (source: WRI - CAIT)",
         yaxis = list(title = "GHG emissions"), 
         xaxis = list(title = "Years"))
```

### The World resources Institute - UNFCCC

```{r warning=FALSE, message=FALSE, echo = TRUE}
OGS.MAP.WRI.UNFCCC = function(wri_data, start_date, end_date, geoscale,sector.filter,gas.filter,geoname.filter,datasource.filter){
  wri_UNFCCC_data_OGS = wri_data %>% 
    filter(Data.source == datasource.filter,
           Country == geoname.filter)%>% 
    # recode sectors and gas values
    mutate(sector = fct_collapse(Sector, "All" = "Total GHG emissions with LULUCF"),
           gas = fct_collapse(Gas, "All" = "Aggregate GHGs")) %>% 
    # filter gas and sector
    filter(sector == sector.filter,
           gas == gas.filter) %>% 
    # pivot data
    pivot_longer(
      cols = starts_with("X"), 
      names_to = "year",
      names_prefix = "X",
      values_to = "value") %>% 
    mutate_at("year" , as.numeric) %>% 
    arrange(year) %>% 
    add_column(data.provider = "WRI.UNFCCC",
               geo.scale = geoscale,
               geo.code.iso3c = NA,
               geo.code.iso2c = NA,
               unit = "MtCO₂e") %>% 
    rename(data.source = Data.source,
           geo.name = Country,
           value = value) %>% 
    select(data.source, data.provider, geo.scale, geo.code.iso2c, geo.code.iso3c, geo.name,
           year, sector, gas, value) %>% 
    filter(year >= start_date & year <= end_date) %>% 
    mutate_at("value" , as.numeric) 
  
  return(wri_UNFCCC_data_OGS)
}


wri_UNFCCC_data_OGS_fr = OGS.MAP.WRI.UNFCCC(wri_data = ghg_emissions_wri,
                                datasource.filter = "UNFCCC_AI",
                                geoname.filter = "France",
                                gas.filter = "All",
                                sector.filter = "All",
                                geoscale = "Country",
                                start_date = 1990,
                                end_date = 2016)

# plot timeserie
wri_UNFCCC_data_OGS_fr %>% 
  plot_ly() %>% 
  add_trace(y = ~value, 
            x = ~year, 
            type = 'scatter',
            mode = 'lines+markers',
            orientation = "v",
            hoverinfo = 'text',
            text = ~paste('</br> Year: ', year,
                          '</br> Value: ', value,
                          '</br> Gas: ', gas,
                          '</br> Sector: ', sector,
                          '</br> Source: ', data.provider)) %>% 
  layout(title = "France GHG emissions (source: WRI - UNFCCC)",
         yaxis = list(title = "GHG emissions"), 
         xaxis = list(title = "Years"))
```

### CITEPA

Created in 1961, [CITEPA (Technical Reference for Air Pollution and Climate Change)](https://www.citepa.org/en/about/) quantifies, identifies, expertises and reports atmospheric emissions data, explanatory variables and efficiency indicators, as well as methods for monitoring, quantifying, projecting and modeling emissions, policies and measures of mitigation and adaptation.

As a non-profit organisation and State operator for the French Environment Ministry, the Citepea meets reporting requirements for air pollutants and greenhouse gas emissions from France in different inventory formats, such as UNFCCC, EMEP, and Kyoto Protocol.

---

**Data:**

Citepa officially estimates greenhouse gas and air polluant emissions each year on behalf of the Ministry of the Environment. his inventory is carried out as part of France’s international commitments, mainly under the United Nations Framework Convention on Climate Change (as well as the Kyoto Protocol and the Paris Agreement) for greenhouse gases, and the United Nations Economic Commission for Europe for pollutants (LRTAP Convention).

All produced data and official reports can be download [from this page](https://www.citepa.org/fr/telechargements/).

https://www.data.gouv.fr/fr/datasets/inventaire-de-gaz-a-effet-de-serre-territorialise/


## Data compilation

In this section we will combine the different data sources in order to compare ghg emissions' values

```{r warning=FALSE, message=FALSE, echo = TRUE}
# combine data sources
OGS_ghg_emission_fr = bind_rows(Worldbank_data_OGS_fr, 
                                wri_CAIT_data_OGS_fr,
                                wri_UNFCCC_data_OGS_fr,
                                eea_data_OGS_fr)

# plot timeserie
OGS_ghg_emission_fr %>% 
  filter(year >= 1990) %>%
  plot_ly() %>% 
  add_trace(y = ~value, 
            x = ~year, 
            color = ~data.provider,
            type = 'scatter',
            # type = "line",
            mode = 'lines+markers',
            orientation = "v",
            hoverinfo = 'text',
            text = ~paste('</br> Year: ', year,
                          '</br> Value: ', value,
                          '</br> Gas: ', gas,
                          '</br> Sector: ', sector,
                          '</br> Source: ', data.provider)) %>% 
  layout(title = "France GHG emissions",
         yaxis = list(title = "GHG emissions (MtCO₂)"), 
         xaxis = list(title = "Years"))

```


# Sub-national scale: France use case

## Introduction

GHG reporting for sub-national territories may refer to multiple geographical divisions such as: municipalities, districts, regions...
Different approaches may be undertaken for assessing carbon footprint of territories:

- **Spatial inventory of GHG emissions:** It refers to national methods used under Kyoto Protocol applied at the territorial level; It covers direct emissions and Scope 2 emissions. Examples of frameworks: [OMINEA](https://www.citepa.org/fr/ominea/)
- **Holistic approach:** It consists of assessing all the emissions produced by territory activity, including direct and indirect emissions. Examples of frameworks: Bilan Carbone® Territoire; Global Protocol for Community...
- **Consumption approach:** It refers to assessing all emissions ,ecessary for inhabitants in a territory, including direct and indirect emissions  from importation.

ADEME provides in [this article](https://www.bilans-ges.ademe.fr/en/accueil/contenu/index/page/territory_reporting/siGras/0) a comprehensive comparison of these different approaches for GHG assessment.

## Data sources

### ADEME - BEGES

#### Data exploration

#### Data mapping

### CITEPA - IGT

#### Data exploration

```{r warning=FALSE, message=FALSE, echo = TRUE}
citepa_IGT = read.csv(file ="https://raw.githubusercontent.com/OpenGeoScales/CarbonData/main/datasets/raw/citepa/igt/IGT%20-%20Pouvoir%20de%20r%C3%A9chauffement%20global-full.csv",
                                   encoding = "UTF-8")

citepa_IGT_OGS = citepa_IGT %>% 
  mutate(Total_emissions = rowSums(.[3:12], na.rm = TRUE))
  

# plot map of vulnerability index

library(leaflet)
library(RColorBrewer)

pal <- colorQuantile(palette = "RdYlBu", n = 5,
                     domain = citepa_IGT_OGS$Total_emissions,
                     reverse = TRUE)

labels <- sprintf(
  "<strong>%s</strong><br/><strong>%s</strong><br/>",
  paste("Name", citepa_IGT_OGS$Commune, sep=": "), 
  paste("Total emissions", round(citepa_IGT_OGS$Total_emissions,2), sep =": ")
) %>% 
  lapply(htmltools::HTML)

leaflet(data = citepa_IGT_OGS, height = 400, width = "100%") %>% 
  addTiles() %>%
  addProviderTiles(providers$CartoDB.DarkMatter) %>% 
  addCircleMarkers(~lon, ~lat, 
                   radius = 1,
                   color = ~pal(Total_emissions),
                   stroke = FALSE,
                   fillOpacity = 0.7,
                   weight = 100,
                   popup = ~as.character(Commune), 
                   label = labels) %>% 
  addLegend(pal = pal, values = ~Total_emissions, opacity = 0.9, 
            title = "Total emissions",
            position = "bottomright",
            labFormat = labelFormat(suffix = " "))
```

#### Data mapping

## Data compilation

